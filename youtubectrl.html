<html>
    <head>
        <meta charset="utf-8">
        <style>
            body{
                font-family: "Ubuntu Mono", monospace;
                line-height: 200%;
                font-size: 24pt;
            }
            button{
                font-size: 24pt;
                margin-right: 2em;
            }
            input{
                font-size: 24pt;
                margin-right: 1em;
            }
        </style>
    </head>
    <body>
        <h1>Infoscreen Youtube Control</h1>
        <button id="btnStop" onclick="makeStopRequest();">stop</button><span class="spacer"></span><button id="btnPause" onclick="makePauseRequest();">pause</button><br/><br/>
        <input type="text" id="v"><button id="btnGo" onclick="makeVRequest();">go</button>
        <br/><br/>
        <h2>Status</h2>
        Video id: <span id="spvideoid"></span><br/><br/>
        Active: <span id="spactive"></span><br/><br/>
        Paused: <span id="sppaused"></span><br/><br/>
        <script>
        var evtSource = new EventSource('eventstream');
        evtSource.addEventListener('youtube-v', e => document.getElementById('spvideoid').innerText = e.data);
        evtSource.addEventListener('youtube-active', e => document.getElementById('spactive').innerText = e.data);
        evtSource.addEventListener('youtube-pause', e => document.getElementById('sppaused').innerText = e.data);

        fetch('/ytcache').then(r => r.json()).then(ytcache => {
            document.getElementById('spvideoid').innerText = ytcache.v;
            document.getElementById('spactive').innerText = ytcache.active;
            document.getElementById('sppaused').innerText = ytcache.pause;
        });

        var pause = false;


        function makeStopRequest(){
            var request = new XMLHttpRequest();
            request.open('GET', 'youtubeupdate?active=false&pause=false', true);
            request.send();
        }

        function makePauseRequest(){
            var pstr = "false";
            if(!this.pause){
                pstr = "true";
                this.pause = true;
            }else{
                pstr = "false";
                this.pause = false;
            }
            var request = new XMLHttpRequest();
            request.open('GET', 'youtubeupdate?pause=' + pstr, true);
            request.send();
        }

        function makeVRequest(){
            var v = (document.getElementById('v').value + "").trim();
            var request = new XMLHttpRequest();
            request.open('GET', 'youtubeupdate?active=true&pause=false&v=' + encodeURIComponent(v) , true);
            request.send();
        }

        </script>
    </body>
</html>